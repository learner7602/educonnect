<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EduConnect - Class Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-gradient-to-r from-blue-700 to-green-600 text-white py-4 px-6 text-center shadow-lg">
    <h1 class="text-3xl font-extrabold">EduConnect</h1>
  </header>

  <!-- Classes Section -->
  <main class="container mx-auto px-4 py-8">
    <h2 class="text-2xl font-bold text-center mb-8">Choose Your Class</h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <button class="class-btn bg-blue-500 text-white py-4 rounded-lg font-semibold" data-class="v">Class V</button>
      <button class="class-btn bg-blue-500 text-white py-4 rounded-lg font-semibold" data-class="vi">Class VI</button>
      <button class="class-btn bg-blue-500 text-white py-4 rounded-lg font-semibold" data-class="vii">Class VII</button>
      <button class="class-btn bg-blue-500 text-white py-4 rounded-lg font-semibold" data-class="viii">Class VIII</button>
      <button class="class-btn bg-blue-500 text-white py-4 rounded-lg font-semibold" data-class="ix">Class IX</button>
      <button class="class-btn bg-blue-500 text-white py-4 rounded-lg font-semibold" data-class="x">Class X</button>
      <button class="class-btn bg-blue-500 text-white py-4 rounded-lg font-semibold" data-class="xi">Class XI</button>
      <button class="class-btn bg-blue-500 text-white py-4 rounded-lg font-semibold" data-class="xii">Class XII</button>
    </div>

    <!-- Sign In Form -->
    <div id="signin-form-container" class="hidden mt-8 bg-white shadow-lg p-6 rounded-lg max-w-md mx-auto">
      <h3 id="signin-class-title" class="text-xl font-bold mb-4">Sign In for Class</h3>
      <form id="signin-form" class="space-y-4">
        <input type="email" id="signin-email" placeholder="Email" class="w-full border p-2 rounded" required>
        <input type="password" id="signin-password" placeholder="Password" class="w-full border p-2 rounded" required>
        <button type="submit" class="bg-green-600 text-white py-2 px-4 rounded w-full">Sign In</button>
      </form>
      <p id="signin-message" class="mt-4 text-center text-red-500"></p>
      <p class="mt-4 text-center text-sm">Don’t have an account? 
        <a href="#" id="show-signup" class="text-blue-600 hover:underline">Sign Up</a>
      </p>
    </div>

    <!-- Sign Up Form -->
    <div id="signup-form-container" class="hidden mt-8 bg-white shadow-lg p-6 rounded-lg max-w-md mx-auto">
      <h3 id="signup-class-title" class="text-xl font-bold mb-4">Sign Up for Class</h3>
      <form id="signup-form" class="space-y-3">
        <input type="text" id="signup-name" placeholder="Full Name" class="w-full border p-2 rounded" required>
        <input type="text" id="signup-father" placeholder="Father's Name" class="w-full border p-2 rounded" required>
        <input type="text" id="signup-school" placeholder="School Name" class="w-full border p-2 rounded" required>
        <input type="text" id="signup-address" placeholder="Address" class="w-full border p-2 rounded" required>
        <input type="tel" id="signup-phone" placeholder="Mobile Number" class="w-full border p-2 rounded" required>
        <input type="email" id="signup-email" placeholder="Email" class="w-full border p-2 rounded" required>
        <input type="password" id="signup-password" placeholder="Password" class="w-full border p-2 rounded" required>
        <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded w-full">Sign Up</button>
      </form>
      <p id="signup-message" class="mt-4 text-center text-red-500"></p>
      <p class="mt-4 text-center text-sm">Already have an account? 
        <a href="#" id="back-to-signin" class="text-blue-600 hover:underline">Sign In</a>
      </p>
    </div>
  </main>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyApjKA34mwvz_gWH9V0RY4wHbmMEP6oqRg",
      authDomain: "educonnectapp-ae08d.firebaseapp.com",
      projectId: "educonnectapp-ae08d",
      storageBucket: "educonnectapp-ae08d.appspot.com",
      messagingSenderId: "10974354104",
      appId: "1:10974354104:web:228ca789dfb241f43ff24d"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let selectedClass = null;

    // Show sign in form when a class is clicked
    document.querySelectorAll('.class-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        selectedClass = btn.dataset.class;
        document.getElementById('signin-class-title').innerText = `Sign In for Class ${selectedClass.toUpperCase()}`;
        document.getElementById('signup-class-title').innerText = `Sign Up for Class ${selectedClass.toUpperCase()}`;
        document.getElementById('signin-form-container').classList.remove('hidden');
        document.getElementById('signup-form-container').classList.add('hidden');
      });
    });

    // Toggle to sign up
    document.getElementById('show-signup').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('signin-form-container').classList.add('hidden');
      document.getElementById('signup-form-container').classList.remove('hidden');
    });

    // Toggle back to sign in
    document.getElementById('back-to-signin').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('signup-form-container').classList.add('hidden');
      document.getElementById('signin-form-container').classList.remove('hidden');
    });

    // Handle sign in
    document.getElementById('signin-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('signin-email').value;
      const password = document.getElementById('signin-password').value;

      try {
        const result = await auth.signInWithEmailAndPassword(email, password);
        const user = result.user;

        // Save login timestamp
        await db.collection(`Class-${selectedClass.toUpperCase()}`).doc(user.uid).set({
          email: user.email,
          uid: user.uid,
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });

        window.location.href = `class-${selectedClass}.html`;

      } catch (error) {
        document.getElementById('signin-message').innerText = error.message;
        alert("Sign In Error: " + error.message); // ✅ Debug alert
      }
    });

    // Handle sign up
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('signup-name').value;
      const father = document.getElementById('signup-father').value;
      const school = document.getElementById('signup-school').value;
      const address = document.getElementById('signup-address').value;
      const phone = document.getElementById('signup-phone').value;
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;

      try {
        const result = await auth.createUserWithEmailAndPassword(email, password);
        const user = result.user;

        // Store additional data in Firestore
        await db.collection(`Class-${selectedClass.toUpperCase()}`).doc(user.uid).set({
          fullName: name,
          fatherName: father,
          schoolName: school,
          address: address,
          phone: phone,
          email: user.email,
          uid: user.uid,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        window.location.href = `class-${selectedClass}.html`;

      } catch (error) {
        document.getElementById('signup-message').innerText = error.message;
        alert("Sign Up Error: " + error.message); // ✅ Debug alert
      }
    });
  </script>
</body>
</html>
